<!DOCTYPE html>
<html>
    <head>
        <title>E-commerce main page</title>
        <meta charset="utf-8">
        <link rel="stylesheet" type="text/css" href="main.css">

        
    </head>
    <body>
        <header class="main" >
            <h1 id="header">Jhee's Cafe Shop</h1>
        </header>
        <nav class="main">
            <button id="upper"><span>메인페이지</span></button>
            <button id="upper"><a href="login.html">로그인</a></button>
            <button id="upper"><a href="signup.html">회원가입</a></button><hr>
        </nav>
        <h2 class="main">Menu<hr></h2>
        <main class="about-product">
            <aside>
                <form id="sub">
                    <p>
                        <label>Choose a Category<br></label>
                        <select id="selection">
                            <option value="All">All</option>
                            <option value="coffee">Coffee</option>
                            <option value="beverage">Beverage</option>
                            <option value="food">Food</option>
                        </select>
                    </p><br>
                    <p>
                        <label>Enter Search Term<br>
                        <input type="text" id="search" placeholder="ex) Americano"></label>
                    </p><br>
                    <button id="searchEngine" type="submit" onsubmit="update(e)">Search</button>
                </form>
                
            </aside>
            <section id="product-list">
                <div class="posts"></div>
            </section>
        </main><br>
        <footer>
            <h2 class="main">페이지 소개<hr></h2>
            <div class="footer">
                <p>해당 웹페이지는 인터넷 프로그래밍 3번째 과제를 위해 만들어졌습니다. 대표적인 세 가지 카페에서 대표 음료 또는 시그니처 메뉴
                    를 소개했습니다. 각 상품별로 브랜드와 가격, 칼로리 등의 설명을 덧붙여 비교하기 쉽도록 만들었습니다. 메뉴는 크게 마실 것과 음식으로
                    나누었습니다. 마실 것으로는 커피와 음료를 두었고, 음식에는 빵류와 디저트류를 추가하였습니다. 각종 메뉴에 쓰인 소개 및 이미지는 각각
                    스타벅스, 투썸플레이스, 이디야커피 공식 홈페이지에서 가져왔음을 알려드립니다.
                </p>
            </div>
        </footer>
        <script>
            var rightSection = document.querySelector('#product-list');
            let finalList = new Array;
            
            window.onscroll = () => {
                load(products);
                if (rightSection.scrollHeight - rightSection.scrollTop <= rightSection.clientHeight) {
                    load(finalList); }
            };
    
            //fetch product.json
            fetch('product.json')
            .then(response => response.json())
            .then(json => {products = json;})
            .then(() => {
                load(products);
            })
            .catch(error => {console.log("Error", error);})
    
    
            function addItem(obj) {
                const post = document.createElement('div');
                post.id = 'item';
                post.innerHTML = "<br>" + obj.name + " (" + obj.brand + ")<br>";
                    
                const image = document.createElement("img");
                image.src = obj.img;
                post.insertAdjacentElement("afterbegin", image);
    
                const btn = document.createElement("input");
                btn.id = 'view';
                btn.type = 'button';
                btn.value = "view more";
                post.insertAdjacentElement("beforeend", btn);
    
                document.querySelector('.posts').append(post);
    
                btn.addEventListener("click", function(event) { 
                    if (document.getElementById("more")) {
                        if (post.lastChild.innerHTML == obj.price + "won<br>" + obj.calory + "kcal<br>"){
                            post.lastChild.remove();
                            return;
                        }
                    }
                    const more = document.createElement('div');
                    more.id = "more";
                    more.innerHTML = obj.price + "won<br>" + obj.calory + "kcal<br>";
                    post.insertAdjacentElement("beforeend", more);
                });
            }
    
    
            function load(arr) {
                for (let i = 0; i < arr.length; i++) {
                    addItem(arr[i]);
                }
            }
    
    
            function update(e) {
                
                e.preventDefault();
                
                var parent = document.querySelector('.posts');
                while (parent.hasChildNodes()) {
                    parent.removeChild();
                }

                let categoryWord = document.getElementById('selection').value;
                let keywordSearch = document.getElementById('search').value;
                
                if (categoryWord === "All"){
                    if (keywordSearch === "") {
                        finalList = products;
                    }else {
                        for (let i = 0; i < 20; i++){
                            if (products[i].name.toLowerCase().includes(keywordSearch.toLowerCase())){
                                finalList.push(products[i]);
                            }
                        }
                    }
                } else {
                    if (keywordSearch === "") {
                        for (let i = 0; i < 20; i++){
                            if (products[i].type == categoryWord){
                                finalList.push(products[i]);
                            }
                        }
                    } else {
                        for (let i = 0; i < 20; i++){
                            if (products[i].type == categoryWord && products[i].name.toLowerCase().includes(keywordSearch.toLowerCase())){
                                finalList.push(products[i]);
                            }
                        }

                    }
                }

                if (finalList.length == 0) {
                    const notExisted = document.createElement("div");
                    notExisted.innerHTML = "Not Existed."
                    document.querySelector('.posts').appendChild(notExisted);
                } else {
                    load(finalList);
                }
            }
    
            
        </script>
    </body>
    
</html>
